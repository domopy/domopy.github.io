---
title: 浅析pid-原理到公式
description: 总结网上对pid的理解，适合用于讲解pid
author: domopy
date: 2025-06-02 15:00:00 +0800
categories: [博客, 技术]
tags: [算法]
pin: true
math: true
mermaid: true

---
## 浅析pid

#### pid引入

###### 先来一个小例子

[PID Web Sim (skythinker.top)](https://pid-simulator-web.skythinker.top/)

*牛二---微分方程建立---拉普拉斯逆变换----传递函数*

matlab的simulink调参

###### 一些控制系统专业术语的介绍：

传递函数：反应系统输入量和输出量之间的关系

![img](https://jsd.cdn.zzko.cn/gh//wocmuch/formyweb@main/ef809e2c82e2b16a80deec8a1cb6f8e8.png)

被控对象：需要控制的对象，案例中指小球
**目标值：期望被控对象达到的状态量，案例中指目标位置的坐标**
**反馈值：被控对象当前时刻的状态量，案例中指小球的实时位置坐标**
**输出量：PID的计算结果，案例中指控制力**
误差：目标值-反馈值
**稳态误差：系统稳定状态下仍存在的误差，如案例中加入干扰恒力后小球静止时仍存在的误差**
阶跃输入：在稳定状态下目标值发生突然变化
阶跃响应：阶跃输入后被控对象的跟随状态，能够代表系统的控制性能
**响应时间：阶跃输入后被控对象第一次次到达目标值的时间**
**超调量：阶跃输入后，被控对象到达目标值后超出目标值的距离**

#### 连续pid公式

![连续pid公式](https://jsd.cdn.zzko.cn/gh//wocmuch/formyweb@main/e3b187f2a8a834715c2309bc22d2c304.png)

Kp —— 比例增益，Kp与比例度成倒数关系；
Tt —— 积分时间常数；Ki
TD —— 微分时间常数；
u(t) —— pid控制器的输出信号；
e(t) —— 给定值 r (t) 与测量值之差。

###### pid三个参数的作用

**Kp--比例控制**。即时成比例的反映控制系统的偏差信号，偏差一旦产生，控制器立即产生控制作用，以减少偏差。通常随着值的加大，闭环系统的超调量加大，系统响应速度加快，但是当增加到一定程度，系统会变得不稳定

**最基础的控制，少了谁都行，少了它不行。有PI控制，也有PD控制，但没有ID控制**。太大会震荡。

**Ki--积分控制。**（需要注意的是这里的Ki不等于上述公式的Tt）主要用于消除静差，提高系统的无差度。积分作用的强弱取决于积分常数，越大，积分作用越弱，反之越强。通常在不变的情况下，越大，即积分作用越弱，闭环系统的超调量越小，系统的响应速度变慢。

**实际是对误差进行积分，在控制初期未达到目标值的时候，起到一个“加速”的作用；在系统存在稳态误差的时候起到消除稳态误差的作用。**太大会震荡。

**Kd--微分控制**。减小超调量，克服振荡，使系统的稳定性提高，同时加快系统的**动态**响应速度，减小调整时间，从而改善系统的动态性能。

#### 离散pid公式

由于PID算法原型是连续函数，这样的一个操作在计算机中怕是不太行，所以需要将其离散化。从时刻0开始每隔 △t 时间间隔进行数据采样，则会形成下列一系列时间节点

(e0,e1,e2,e3 … ek)

相应的有

(u0,u1,u2,u3 … uk)

###### 位置式pid



![在这里插入图片描述](https://jsd.cdn.zzko.cn/gh//wocmuch/formyweb@main/0dae09df6af6f628978bbbe9ec2c8836.png)

![在这里插入图片描述](https://jsd.cdn.zzko.cn/gh//wocmuch/formyweb@main/002928bec8f04e5f8d656dad233f1eb9.png)

###### 增量式pid

![在这里插入图片描述](https://jsd.cdn.zzko.cn/gh//wocmuch/formyweb@main/7da880c123a9ba342127c595be7b7ccc.png)

###### 区别：

- 位置式需防积分饱和，增量式不会产生**积分饱和**
- 只有存在偏差时，增量式才会有输出
- 增量式容易实现从手动到自动的切换
- 位置式PID控制的输出与整个过去的状态有关，用到了误差的累加值;而增量式PID的输出只与当前拍和前两拍的误差有关，因此位置式PID控制的累积误差相对更大
- **最直接的使用判断**：看输出，看需要的输出是直接作用于系统，还是需要和上次输出累加再作用于系统。

###### 代码环节

```c
float pid_calc(pid_t *pid, float get, float set) {
    pid->get[NOW] = get;                //测量值
    pid->set[NOW] = set;                //目标值
    pid->err[NOW] = set - get;          //set - measure 目标值-测量值//本次误差 和 死区判断
    if (pid->max_err != 0 && ABS(pid->err[NOW]) > pid->max_err)
        return 0;
    if (pid->deadband != 0 && ABS(pid->err[NOW]) < pid->deadband)
        return 0;

    //位置式p
    if (pid->pid_mode == POSITION_PID) {
        pid->pout = pid->p * pid->err[NOW];
        pid->iout += pid->i * pid->err[NOW];
        pid->dout = pid->d * (pid->err[NOW] - pid->err[LAST]);
        abs_limit(&(pid->iout), pid->IntegralLimit);
        pid->pos_out = pid->pout + pid->iout + pid->dout;
        abs_limit(&(pid->pos_out), pid->MaxOutput);
        pid->last_pos_out = pid->pos_out;    //update last time
    }
    //增量式P
    else if (pid->pid_mode == DELTA_PID) {
        pid->pout = pid->p * (pid->err[NOW] - pid->err[LAST]);
        pid->iout = pid->i * pid->err[NOW];
        pid->dout = pid->d * (pid->err[NOW] - 2 * pid->err[LAST] + pid->err[LLAST]);
        abs_limit(&(pid->iout), pid->IntegralLimit);
        pid->delta_u = pid->pout + pid->iout + pid->dout;
        pid->delta_out = pid->last_delta_out + pid->delta_u;
        abs_limit(&(pid->delta_out), pid->MaxOutput);
        pid->last_delta_out = pid->delta_out;    //update last time
    }
    //迭代
    pid->err[LLAST] = pid->err[LAST];
    pid->err[LAST] = pid->err[NOW];
    pid->get[LLAST] = pid->get[LAST];
    pid->get[LAST] = pid->get[NOW];
    pid->set[LLAST] = pid->set[LAST];
    pid->set[LAST] = pid->set[NOW];
    return pid->pid_mode == POSITION_PID ? pid->pos_out : pid->delta_out;
}
```



#### 串级pid

单级PID，目标值和反馈值经过一次PID计算就得到输出值并直接作为控制量，但如果目标物理量和输出物理量之间不止差了一阶的话，中间阶次的物理量我们是无法控制的。比如：目标物理量是位置，输出物理量是加速度，则小球的速度是无法控制的。

而串级PID就可以改善这一点。串级PID其实就是两个单级PID“串”在一起组成的，它的信号框图如下

![img](https://jsd.cdn.zzko.cn/gh//wocmuch/formyweb@main/c462c37c05bb6d64bdb830feae1fb238.png)

![img](https://jsd.cdn.zzko.cn/gh//wocmuch/formyweb@main/901666426b59ad3f3bfb12f24b47ed76.png)

可以发现，内环与小球构成了一个恒速系统，PID内环负责小球的速度控制；而如果把内环和小球看作一个整体被控对象，外环又与这个对象一起构成了一个位置控制系统，外环负责位置控制；总体来说，外环负责根据小球位置误差计算出小球需要达到的速度，而内环负责计算出控制力使小球达到这个目标速度，两个环协同工作，就可以完成任务了。

simulink仿真

一个例子。。。电机的速度环及其位置环。

#### 其他pid

###### 积分分离式PID

为了消除稳态误差，常在PID控制中引入积分环节。但在启动、结束或大幅度更改设定值时，积分输出可能会引起较大超调甚至震荡，所以采用了积分分离输出，即在误差较大时屏蔽积分环节，当误差小于一定范围时，引入积分控制，使得偏差较大时确保响应速度 偏差较小时确保精度。

###### 变速积分PID

变速积分PID的基本思想是设法改变积分项的累加速度，使其与偏差大小相对应，偏差越大，积分越慢，反之则越快。

###### 不完全微分PID

微分作用很容易引进高频干扰，可以串接一个低通滤波器来抑制高频影响，改善了系统的动态性能，提高了系统的控制精度。又可理解为用实际PD环节代替理想PD环节，使微分作用对于偏差的变化不会有太大反应，单独对微分项进行低通滤波，提高对噪声的抑制能力。

###### 微分先行PID

在设定目标点后，目标位置一般会发生阶跃改变，为了消除目标值突然变化带来的抖动，可对测量值进行微分作用，使得设定值的调整变得缓和。

###### 前馈pid

加入前馈补偿可以很好地改善系统的跟踪性能。在编程中，使用前馈补偿的P I D PIDPID算法，在计算uf时，可对1 / G ( s ) 1/G(s)1/G(s)进行Z 变换并离散化。

###### 神经网络pid

###### 专家pid

###### 模糊pid

#### pid注意事项

1、使用位置式pid的时候，如若要使用Ki控制，一定要记得做**积分输出限幅**。

2、一定要搞清楚方向，输出和输入的方向。

3、一定要搞清楚一个系统的输入和输出分别是什么。

举个例子：

任务：对电机进行串级角度控制

可用条件：电机实时角度、电机实时转速、可以控制电机电流大小

分析：外环负责电机角度控制，根据电机目标角度和反馈角度计算出目标转速；内环负责转速控制，根据速度反馈和目标转速计算出电流

任务：四旋翼无人机的翻滚角串级控制。如何用pid去控制。如何用串级pid去控制。

可用条件：imu返回的角度，角速度，四个旋翼电机的pwm输入

分析：？？？

#### pid调参秘籍【绝密】

【注意】只是经验

1.将p和i和d设置为全局变量，然后调试时候用debug会事半功倍

2.一般先把i和d设为0

3.慢慢调p，如果发现怎么调都调不好可以尝试p给个负值试试

4.首先，先给个很小的p值，然后给个稍微大一点的p值，例如1和200（根据情况而定），看看控制的对象有没有明显的效果，表现为p小的时候，力气很小可以用手轻易掰动他，p大的时候能感受到明显的阻力

5.如果第四部能感受到，那么第五步就是从小到大给p，你会发现控制对象力气越来越大，当到达一定的值时，会发现控制对象开始抖动，这个很正常，因为p太大，pid震荡幅度越来越大，超调了

6，记录产生震荡的p的值为p1，然后往回调，直到停止震荡，记录此时震荡的p值位p2

7.最后根据实际情况，p的值应该在80%p2到90%p2之间

8.p调稳定之后，开始加d，一般情况下在第7步时，i和d为0，假如控制对象是电机，空载情况下只要一个p就足够了，如果这个电机需要带动一定重量的物体旋转，会发现只有p会发生如下情况：用力拨动整个结构，会感受到电机给的力越来越大，继续拨动，直到电机旋转90度，这个时候力已经很大了，此时放开，让他从90度归位到原来位置，会发现他并不会马上停在0度，而是会跑到-10度左右然后弹回来，一直震荡，慢慢靠近0

9.如果出现8的情况，这时候慢慢加d，先检验d有没有作用，和4的p一样，先给个小的d再给个稍微大的d，d太大会震荡，一般1和20差不多，如果发现用8的方法拨动机械，发现机械不会到-10，到-5就往回弹了（大概一个数字，可能直接就到0度也可能），说明d有效果

10.发现9有效果的话，和p一样，慢慢调大，重复8的步骤一直去拨动电机，看他反弹的情况，如果发现d太大已经导致电机抖动了了，就不要再加大了，看看这个效果你满不满意，用在这个项目够不够用，一般到这里是够了

11.如果10的效果还不满意，用户需要的是迅速从90度反应到0度，那么可以考虑适当减少p，p减少了，d可以稍微往上抬，就不会像10那样电机抖动了